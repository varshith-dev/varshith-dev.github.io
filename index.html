<!-- index.html -->
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Nabha Digital Learning Hub</title>
  <link rel="stylesheet" href="./css/style.css" />
  <script type="module">
    import { auth } from "./firebase.js";
    import { GoogleAuthProvider, signInWithPopup } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-auth.js";
    import { loadLocale, initAuthGuard } from "./app.js";

    window.addEventListener("load", async () => {
      await loadLocale("en");
      initAuthGuard({ protectedPages: ["student.html","teacher.html","admin.html"] });
      document.querySelectorAll("[data-i18n]").forEach(el => {
        // already replaced by loadLocale
      });
    });

    window.signInWithGoogle = async () => {
      try {
        const provider = new GoogleAuthProvider();
        provider.setCustomParameters({ prompt: "select_account" });
        const result = await signInWithPopup(auth, provider);
        const email = result.user?.email || "";
        if (!email.toLowerCase().endsWith("@gmail.com")) {
          alert("Only Gmail accounts allowed. Signing out.");
          await auth.signOut();
          return;
        }
        // onAuthStateChanged in app.js will redirect
      } catch (e) {
        alert("Sign in failed: " + e.message);
      }
    }
  </script>
</head>
<body>
  <div class="container">
    <header class="header">
      <div class="logo" data-i18n="app_title">Nabha Digital Learning Hub</div>
      <div class="badge small">Gmail-only</div>
    </header>

    <main class="grid grid-2">
      <section class="card">
        <h3 data-i18n="login_google">Sign in with Google (Gmail only)</h3>
        <p class="small">Use your Gmail account. Teacher/Admin rights are set by admin via admin dashboard.</p>
        <div class="top-actions" style="margin-top:12px">
          <button onclick="signInWithGoogle()" style="background:var(--accent);color:#042133;padding:10px 14px;border-radius:10px">Sign in with Google</button>
        </div>
      </section>

      <section class="card">
        <h4 class="small">Why Gmail-only?</h4>
        <p class="small">Simplifies sign-in, avoids phone OTP, and ensures accounts are real Google accounts.</p>
      </section>
    </main>

    <footer style="margin-top:14px" class="small">Built for rural schools in Nabha â€” teacher content, offline-ready.</footer>
  </div>
</body>
</html>
